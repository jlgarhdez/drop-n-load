<!DOCTYPE html>

<html>
<head>
  <title>#</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>This <span class="class"><span class="keyword">class</span> <span class="title">will</span> <span class="title">contain</span> <span class="title">all</span> <span class="title">the</span> <span class="title">logic</span> <span class="title">for</span> <span class="title">the</span> <span class="title">drag</span> <span class="title">and</span> <span class="title">drop</span> <span class="title">operations</span>. </span>
author José Luis García &lt;jl.garhdez<span class="property">@gmail</span>.com&gt;
version <span class="number">0.1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1>#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">window</span>.<span class="title">DragAndDrop</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Default settings for the work of the uploader. You can change it here or in
the call to the constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="property">@settings</span> =
    droppableContainerId: <span class="string">'droppable-container'</span>
    borderStyleOnDragover: <span class="string">'6px dashed #444'</span>
    uploadButtonId: <span class="string">'upload-button'</span>
    droppablePlaceholderId: <span class="string">'droppable-placeholder'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Reference to the droppable container</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="property">@container</span> = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>this constructor binds each event to each handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: (settings) -&gt;

    <span class="keyword">if</span> <span class="keyword">typeof</span> settings <span class="keyword">is</span> <span class="string">'object'</span>
      <span class="property">@settings</span> = settings</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Initialize the container element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    DragAndDrop.container = document.getElementById DragAndDrop.settings.droppableContainerId</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Add the listeners for the drag and drop events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    DragAndDrop.container.addEventListener <span class="string">'drop'</span>,      <span class="property">@dropHandler</span>
    DragAndDrop.container.addEventListener <span class="string">'dragover'</span>,  <span class="property">@dragOverHandler</span>
    DragAndDrop.container.addEventListener <span class="string">'dragleave'</span>, <span class="property">@dragLeaveHandler</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>DragOver handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dragOverHandler: (event) -&gt;
    event.preventDefault()
    DragAndDrop.container.style.border = DragAndDrop.settings.borderStyleOnDragover
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>DragOver handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dragLeaveHandler: (event) -&gt;
    DragAndDrop.container.style.border = <span class="string">"none"</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Drop handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dropHandler: (event) =&gt;
    event.preventDefault()</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>The array of files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    files = event.dataTransfer.files</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>loop through the array of files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="property">@proccessFile</span> file <span class="keyword">for</span> file <span class="keyword">in</span> files
    DragAndDrop.container.style.border = <span class="string">"none"</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Method for processing each file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  proccessFile: (file) -&gt;
    reader = <span class="keyword">new</span> FileReader

    reader.<span class="function"><span class="title">onload</span></span> = (onloadendEvent) -&gt;
      dataUrl = <span class="keyword">this</span>.result

      file.dataUrl = dataUrl</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Add the file to the array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      upload.addFile file

      fileDiv = document.createElement <span class="string">'div'</span>
      fileDiv.setAttribute <span class="string">'class'</span>, <span class="string">'file'</span>
      fileDiv.setAttribute <span class="string">'id'</span>, file.name.replace <span class="regexp">/[^a-z0-9]/gi</span>, <span class="string">''</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Checks if the file is an image to show a thumbnail</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> file.type.match <span class="string">'image.*'</span>
        imageElement = document.createElement <span class="string">'img'</span>
        imageElement.setAttribute <span class="string">'src'</span>, dataUrl
        imageElement.setAttribute <span class="string">'class'</span>, <span class="string">'thumb'</span>
        fileDiv.appendChild imageElement

      filenameElement = document.createElement <span class="string">'span'</span>
      filenameElement.innerHTML = file.name

      fileDiv.appendChild filenameElement
      placeholder =  document.getElementById DragAndDrop.settings.droppablePlaceholderId

      DragAndDrop.container.appendChild fileDiv
      DragAndDrop.container.removeChild placeholder <span class="keyword">if</span> placeholder <span class="keyword">isnt</span> <span class="literal">null</span>
      @

    reader.readAsDataURL file</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
